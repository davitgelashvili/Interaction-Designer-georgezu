<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./../css/owl.carousel.min.css">
    <link rel="stylesheet" href="./../css/owl.theme.default.min.css">
    <link rel="stylesheet" href="./../css/style.css">
    <title>Document</title>
</head>
<body>
    <div class="bg">
    </div>

    <div class="load">
        <span class="load__item"></span>
        <span class="load__item"></span>
        <span class="load__item"></span>
        <span class="load__item"></span>
        <span class="load__item"></span>
        <span class="load__item"></span>
        <span class="load__item"></span>
    </div>

    <section class="detail">
    </section>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

$(window).on('load', function(){
    let item1,item2, item3, item4;
    let title1,title2, title3, title4 
    $('.load').remove();

    const localFilter = document.location.search;
    console.log(localFilter)
    const localId = localFilter.split('=');

    function gallery(item) {
        return (`
            <div class="detail__gallery--item">
                <img src="${item.url}"" />
            </div>
        `)
    }

    function postedWork(){
        const token = 'd820991ca43cc815adf1a0a4a2e08a';
        fetch('https://graphql.datocms.com/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    'Authorization': `Bearer ${token}`,
                },
                body: JSON.stringify({
                    query: `{ 
                        allPortfolios(filter: {id: {in: "${localId[1]}"}}) { 
                            id, role, detailTitle, description, coverDetail {url}, link, 
                            detailSectionTitle1, detailSectionTitle2, detailSectionTitle3, detailSectionTitle4,
                            detailSectionDescription1, detailSectionDescription2, detailSectionDescription3, detailSectionDescription4,
                            gallery {url},
                        },
                    }`
                }),
        })
        .then(res => res.json())
        .then((res) => {
            console.log(res)
            let item = res.data.allPortfolios[0];
            $('.detail').append(`
            <div class="detail__head">
                <div class="detail__head--left">
                    <div class="detail__head--title">
                        <div class="container">
                            <div class="detail__head--text">
                                ${item.detailTitle}
                            </div>    
                        </div>
                    </div>
                </div>
                <div class="detail__head--right">
                    <img src="${item.coverDetail.url}" alt="" class="detail__head--cover">
                </div>
            </div>
            <div class="container">
                <button class="close-page close-work">
                    <a href="./../">
                        <img src="./../img/icons/back-arrow.svg" class="white" alt="">
                        <img src="./../img/icons/back-arrow-black.svg" class="black" alt="">    
                    </a>
                </button>
            </div>
            <div class="detail__body">
                ${item.detailSectionTitle1 && `
                    <div class="detail__body--item 1">
                        <div class="container">
                            <div class="detail__body--item-in">
                                <div class="detail__body--title">
                                    <h1 class="detail__body--title-text 1">${item.detailSectionTitle1}</h1>
                                </div>
                                <div class="detail__body--desc">
                                    ${item.detailSectionDescription1}
                                </div>
                            </div>
                        </div>
                    </div>
                `}
                ${item.detailSectionTitle2 && `
                    <div class="detail__body--item 2">
                        <div class="container">
                            <div class="detail__body--item-in">
                                <div class="detail__body--title">
                                    <h1 class="detail__body--title-text 2">${item.detailSectionTitle2}</h1>
                                </div>
                                <div class="detail__body--desc">
                                    ${item.detailSectionDescription2}
                                </div>
                            </div>
                        </div>
                    </div>
                `}
                ${item.detailSectionTitle3 && `
                    <div class="detail__body--item 3">
                        <div class="container">
                            <div class="detail__body--item-in">
                                <div class="detail__body--title">
                                    <h1 class="detail__body--title-text 3">${item.detailSectionTitle3}</h1>
                                </div>
                                <div class="detail__body--desc">
                                    ${item.detailSectionDescription3}
                                </div>
                            </div>
                        </div>
                    </div>
                `}
                ${item.detailSectionTitle4 && `
                    <div class="detail__body--item 4">
                        <div class="container">
                            <div class="detail__body--item-in">
                                <div class="detail__body--title">
                                    <h1 class="detail__body--title-text 4">${item.detailSectionTitle4}</h1>
                                </div>
                                <div class="detail__body--desc">
                                    ${item.detailSectionDescription4}
                                </div>
                            </div>
                        </div>
                    </div>    
                `}
                ${item.gallery && `   
                    <div class="container">
                        <div style="text-align: center">
                            <h1 class="detail__body--title-text">Finaly</h1>
                        </div>
                        <div class="detail__gallery">
                            ${ item.gallery.map( i => gallery(i) ) }
                        </div>
                    </div>
                `}
            </div>
            `)
        }).finally((e) => {
            // console.log($('.detail__body--title').offset().top)
            item1 = ( $('.detail__body--item.1').offset().top );
            item2 = ( $('.detail__body--item.2').offset().top );
            item3 = ( $('.detail__body--item.3').offset().top );
            item4 = ( $('.detail__body--item.4').offset().top );
        })
    }
    postedWork()
    var headHeight;
    var scroll
    $('.detail').scroll(function() {
        headHeight = $('.detail__head').height();
        scroll = ( $(this).scrollTop() - headHeight )
        $('.detail__body--title-text').removeClass('active')
        if($(this).scrollTop() > item1 && ($(this).scrollTop() < (item2 - 300)) ) {
            $('.detail__body--title-text.1').css({'transform': `translateY(${ scroll }px)`})
        }else if($(this).scrollTop() > item2 && $(this).scrollTop() < (item3 - 100) ) {
            $('.detail__body--title-text.2').css({'transform': `translateY(${ scroll }px)`})
        }else if($(this).scrollTop() > item3 && $(this).scrollTop() < item4) {
            $('.detail__body--title-text.3').css({'transform': `translateY(${ scroll }px)`})
        }else if($(this).scrollTop() > item4 ) {
            $('.detail__body--title-text.4').css({'transform': `translateY(${ scroll }px)`})
        }else {
           $('.detail__body--title-text').removeClass('active')
        }

        if($(this).scrollTop() > ($('.detail__head').height() - 100 ) ) {
            $('.white').hide()
            $('.black').show()
        }else {
            $('.white').show()
            $('.black').hide()
        }
    });

});
</script>

</body>
</html>